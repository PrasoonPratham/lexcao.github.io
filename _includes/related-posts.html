{% if page.tags.size > 0 %}
<div class="related">
  <h2>{{ site.data.locales[page.locale].post.related }}</h2>
  {% assign listed_posts_urls = page.url | split: ' ' %}
  <ul class="related-posts">
    {% for tag in page.tags %}
      {% for related_post in site.tags[tag] limit:3 %}
        {% if listed_posts_urls contains related_post.url %}
        {% else %}
          <li>
            <h3>
              <a href="{{ related_post.url | relative_url }}">
                {{ related_post.title }}
              </a>
            </h3>
          </li>
          {% assign listed_posts_urls = listed_posts_urls | push: related_post.url %}
        {% endif %}
      {% endfor %}
    {% endfor %}
  </ul>
</div>
{% endif %}